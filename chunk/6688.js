"use strict";(self.webpackJsonp=self.webpackJsonp||[]).push([[6688],{"6688":function(A){A.exports=JSON.parse('{"version":3,"names":["indexCss","getTrueType","type","confirmType","password","Error","fixControlledValue","value","Input","this","isOnComposition","isOnPaste","onInputExcuted","handleInput","e","stopPropagation","_f","_this","maxlength","target","inputType","length","substring","onInput","emit","cursor","handlePaste","onPaste","handleFocus","onFocus","handleBlur","onBlur","handleChange","onChange","handleKeyDown","keyCode","code","onKeyDown","onConfirm","handleComposition","HTMLInputElement","handleBeforeinput","data","isNumber","test","preventDefault","indexOf","class_1","prototype","focus","inputRef","watchAutoFocus","newValue","oldValue","_a","watchValue","componentDidLoad","fileListener","addEventListener","_b","_c","_d","_e","Object","defineProperty","el","get","set","configurable","disconnectedCallback","removeEventListener","render","placeholder","autoFocus","disabled","name","nativeProps","h","assign","ref","input","class","onCompositionStart","onCompositionEnd"],"sources":["src/components/input/index.scss?tag=taro-input-core","src/components/input/input.tsx"],"sourcesContent":["taro-input-core {\\n  display: block;\\n}\\n\\ninput {\\n  display: block;\\n  overflow: hidden;\\n  height: 1.4rem;\\n  text-overflow: clip;\\n  text-align: inherit;\\n  white-space: nowrap;\\n}\\n","import { Component, h, ComponentInterface, Prop, Event, EventEmitter, Element, Watch, Method } from \'@stencil/core\'\\nimport { EventHandler, TaroEvent } from \'../../../types\'\\n\\nfunction getTrueType (type: string | undefined, confirmType: string, password: boolean) {\\n  if (confirmType === \'search\') type = \'search\'\\n  if (password) type = \'password\'\\n  if (typeof type === \'undefined\') {\\n    return \'text\';\\n  }\\n  if (!type) {\\n    throw new Error(\'unexpected type\')\\n  }\\n  if (type === \'digit\') type = \'number\'\\n\\n  return type\\n}\\n\\nfunction fixControlledValue (value?: string) {\\n  return value ?? \'\'\\n}\\n\\n@Component({\\n  tag: \'taro-input-core\',\\n  styleUrl: \'index.scss\'\\n})\\nexport class Input implements ComponentInterface {\\n  private inputRef: HTMLInputElement\\n  private isOnComposition = false\\n  private isOnPaste = false\\n  private onInputExcuted = false\\n  private fileListener: EventHandler\\n\\n  @Prop({ mutable: true }) value: string\\n  @Prop() type: string\\n  @Prop() password = false\\n  @Prop() placeholder: string\\n  @Prop() disabled = false\\n  @Prop() maxlength = 140\\n  @Prop({ attribute: \'focus\', reflect: true }) autoFocus = false\\n  @Prop() confirmType = \'done\'\\n  @Prop() name: string\\n  @Prop() nativeProps = {}\\n\\n  @Element() el: HTMLElement\\n\\n  @Method()\\n  async focus() {\\n    this.inputRef.focus()\\n  }\\n\\n  @Watch(\'autoFocus\')\\n  watchAutoFocus (newValue: boolean, oldValue: boolean) {\\n    if (!oldValue && newValue) {\\n      this.inputRef?.focus()\\n    }\\n  }\\n\\n  @Watch(\'value\')\\n  watchValue (newValue: string) {\\n    const value = fixControlledValue(newValue)\\n    if (this.inputRef.value !== value) {\\n      this.inputRef.value = value\\n    }\\n  }\\n\\n  @Event({\\n    eventName: \'input\'\\n  }) onInput: EventEmitter\\n\\n  @Event({\\n    eventName: \'paste\'\\n  }) onPaste: EventEmitter\\n\\n  @Event({\\n    eventName: \'focus\'\\n  }) onFocus: EventEmitter\\n\\n  @Event({\\n    eventName: \'blur\'\\n  }) onBlur: EventEmitter\\n\\n  @Event({\\n    eventName: \'confirm\'\\n  }) onConfirm: EventEmitter\\n\\n  @Event({\\n    eventName: \'change\'\\n  }) onChange: EventEmitter\\n\\n  @Event({\\n    eventName: \'keydown\'\\n  }) onKeyDown: EventEmitter\\n\\n  componentDidLoad () {\\n    if (this.type === \'file\') {\\n      this.fileListener = () => {\\n        this.onInput.emit()\\n      }\\n      this.inputRef?.addEventListener(\'change\', this.fileListener)\\n    } else {\\n      this.inputRef?.addEventListener(\'compositionstart\', this.handleComposition)\\n      this.inputRef?.addEventListener(\'compositionend\', this.handleComposition)\\n      this.inputRef?.addEventListener(\'beforeinput\', this.handleBeforeinput)\\n      this.inputRef?.addEventListener(\'textInput\', this.handleBeforeinput)\\n    }\\n\\n    Object.defineProperty(this.el, \'value\', {\\n      get: () => this.inputRef.value,\\n      set: value => (this.value = value),\\n      configurable: true\\n    })\\n  }\\n\\n  disconnectedCallback () {\\n    if (this.type === \'file\') {\\n      this.inputRef?.removeEventListener(\'change\', this.fileListener)\\n    } else {\\n      this.inputRef?.removeEventListener(\'compositionstart\', this.handleComposition)\\n      this.inputRef?.removeEventListener(\'compositionend\', this.handleComposition)\\n      this.inputRef?.removeEventListener(\'beforeinput\', this.handleBeforeinput)\\n      this.inputRef?.removeEventListener(\'textInput\', this.handleBeforeinput)\\n    }\\n  }\\n\\n  handleInput = (e: TaroEvent<HTMLInputElement>) => {\\n    e.stopPropagation()\\n    const {\\n      type,\\n      maxlength,\\n      confirmType,\\n      password\\n    } = this\\n    if (!this.isOnComposition && !this.onInputExcuted) {\\n      let value = e.target.value\\n      const inputType = getTrueType(type, confirmType, password)\\n      this.onInputExcuted = true\\n      /* 修复 number 类型 maxlength 无效 */\\n      if (inputType === \'number\' && value && maxlength > -1 && maxlength <= value.length) {\\n        value = value.substring(0, maxlength)\\n        e.target.value = value\\n      }\\n\\n      // 修复 IOS 光标跳转问题\\n      // if (!([\'number\', \'file\'].indexOf(inputType) >= 0)) {\\n      //   const pos = e.target.selectionEnd\\n      //   setTimeout(\\n      //     () => {\\n      //       e.target.selectionStart = pos\\n      //       e.target.selectionEnd = pos\\n      //     }\\n      //   )\\n      // }\\n\\n      this.value = value\\n      this.onInput.emit({\\n        value,\\n        cursor: value.length\\n      })\\n      this.onInputExcuted = false\\n    }\\n  }\\n\\n  handlePaste = (e: TaroEvent<HTMLInputElement> & ClipboardEvent) => {\\n    e.stopPropagation()\\n    this.isOnPaste = true\\n    this.onPaste.emit({\\n      value: e.target.value\\n    })\\n  }\\n\\n  handleFocus = (e: TaroEvent<HTMLInputElement> & FocusEvent) => {\\n    e.stopPropagation()\\n    this.onInputExcuted = false\\n    this.onFocus.emit({\\n      value: e.target.value\\n    })\\n  }\\n\\n  handleBlur = (e: TaroEvent<HTMLInputElement> & FocusEvent) => {\\n    e.stopPropagation()\\n    this.onBlur.emit({\\n      value: e.target.value\\n    })\\n  }\\n\\n  handleChange = (e: TaroEvent<HTMLInputElement>) => {\\n    e.stopPropagation()\\n    this.onChange.emit({\\n      value: e.target.value\\n    })\\n\\n    if (this.isOnPaste) {\\n      this.isOnPaste = false\\n      this.value = e.target.value\\n      this.onInput.emit({\\n        value: e.target.value,\\n        cursor: e.target.value.length\\n      })\\n    }\\n  }\\n\\n  handleKeyDown = (e: TaroEvent<HTMLInputElement> & KeyboardEvent) => {\\n    e.stopPropagation()\\n    const { value } = e.target\\n    const keyCode = e.keyCode || e.code\\n    this.onInputExcuted = false\\n\\n    this.onKeyDown.emit({\\n      value,\\n      cursor: value.length,\\n      keyCode\\n    })\\n\\n    keyCode === 13 && this.onConfirm.emit({ value })\\n  }\\n\\n  handleComposition = (e: Event) => {\\n    e.stopPropagation()\\n    if (!(e.target instanceof HTMLInputElement)) return\\n\\n    if (e.type === \'compositionend\') {\\n      this.isOnComposition = false\\n      this.value = e.target.value\\n      this.onInput.emit({\\n        value: e.target.value,\\n        cursor: e.target.value.length\\n      })\\n    } else {\\n      this.isOnComposition = true\\n    }\\n  }\\n\\n  handleBeforeinput = (e) => {\\n    if (!e.data) return\\n    const isNumber = e.data && /[0-9]/.test(e.data)\\n    if (this.type === \'number\' && !isNumber) {\\n      e.preventDefault()\\n    }\\n    if (this.type === \'digit\' && !isNumber) {\\n      if (e.data !== \'.\' || (e.data === \'.\' && e.target.value.indexOf(\'.\') > -1)) {\\n        e.preventDefault()\\n      }\\n    }\\n  }\\n\\n  render () {\\n    const {\\n      value,\\n      type,\\n      password,\\n      placeholder,\\n      autoFocus,\\n      disabled,\\n      maxlength,\\n      confirmType,\\n      name,\\n      nativeProps\\n    } = this\\n\\n    return (\\n      <input\\n        ref={input => {\\n          this.inputRef = input!\\n          if (autoFocus && input) input.focus()\\n        }}\\n        class=\'weui-input\'\\n        type={getTrueType(type, confirmType, password)}\\n        placeholder={placeholder}\\n        autoFocus={autoFocus}\\n        disabled={disabled}\\n        maxlength={maxlength}\\n        name={name}\\n        onInput={this.handleInput}\\n        onFocus={this.handleFocus}\\n        onBlur={this.handleBlur}\\n        onChange={this.handleChange}\\n        onKeyDown={this.handleKeyDown}\\n        onPaste={this.handlePaste}\\n        onCompositionStart={this.handleComposition}\\n        onCompositionEnd={this.handleComposition}\\n        {...nativeProps}\\n        value={fixControlledValue(value)}\\n      />\\n    )\\n  }\\n}\\n"],"mappings":"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"}')}}]);