"use strict";(self.webpackJsonp=self.webpackJsonp||[]).push([[1379],{"1379":function(t,n,l){l.r(n),l.d(n,{"taro_movable_area_core":function(){return u},"taro_movable_view_core":function(){return f}});var h=l(6468),__awaiter=function(t,n,l,h){function i(t){return t instanceof l?t:new l((function(n){n(t)}))}return new(l||(l=Promise))((function(l,u){function s(t){try{c(h.next(t))}catch(t){u(t)}}function o(t){try{c(h.throw(t))}catch(t){u(t)}}function c(t){t.done?l(t.value):i(t.value).then(s,o)}c((h=h.apply(t,n||[])).next())}))},__generator=function(t,n){var l,h,u,f,d={"label":0,"sent":function(){if(1&u[0])throw u[1];return u[1]},"trys":[],"ops":[]};return f={"next":o(0),"throw":o(1),"return":o(2)},"function"==typeof Symbol&&(f[Symbol.iterator]=function(){return this}),f;function o(t){return function(n){return c([t,n])}}function c(v){if(l)throw new TypeError("Generator is already executing.");for(;f&&(f=0,v[0]&&(d=0)),d;)try{if(l=1,h&&(u=2&v[0]?h.return:v[0]?h.throw||((u=h.return)&&u.call(h),0):h.next)&&!(u=u.call(h,v[1])).done)return u;switch(h=0,u&&(v=[2&v[0],u.value]),v[0]){case 0:case 1:u=v;break;case 4:return d.label++,{"value":v[1],"done":!1};case 5:d.label++,h=v[1],v=[0];continue;case 7:v=d.ops.pop(),d.trys.pop();continue;default:if(!(u=d.trys,(u=u.length>0&&u[u.length-1])||6!==v[0]&&2!==v[0])){d=0;continue}if(3===v[0]&&(!u||v[1]>u[0]&&v[1]<u[3])){d.label=v[1];break}if(6===v[0]&&d.label<u[1]){d.label=u[1],u=v;break}if(u&&d.label<u[2]){d.label=u[2],d.ops.push(v);break}u[2]&&d.ops.pop(),d.trys.pop();continue}v=n.call(t,d)}catch(t){v=[6,t],h=0}finally{l=u=0}if(5&v[0])throw v[1];return{"value":v[0]?v[1]:void 0,"done":!0}}},u=function(){function e(t){var n=this;(0,h.r)(this,t),this.views=[],this.scaleLength=0,this.viewsChanged=function(){n.views=[];var t=n.element.querySelectorAll("taro-movable-view-core");Array.from(t).forEach((function(t){n.views.push(t)})),n.updateArea()},this.handleTouchStart=function(t){var l=t.touches;if(l&&!(l.length<=1)){var h=l[1].pageX-l[0].pageX,u=l[1].pageY-l[0].pageY;if(n.scaleLength=Math.sqrt(h*h+u*u),!n.scaleArea){var i=function(t,n){for(var a=function(t,n){return!!(t=t.parentNode)&&((!(t instanceof HTMLElement)||t!==document.body)&&(t===n||t===n.element||t.element===n||a(t,n)))},l=0;l<n.length;l++){var h=n[l];if(t===h.element||a(t,h))return h}},f=i(l[0].target,n.views),d=i(l[1].target,n.views);n.scaleTarget=f&&f===d?f:void 0}}},this.handleTouchMove=function(t){var l=t.touches;if(l&&!(l.length<=1)){t.preventDefault();var h=l[1].pageX-l[0].pageX,u=l[1].pageY-l[0].pageY;n.scaleLength>0&&n.updateScale(Math.sqrt(h*h+u*u)/n.scaleLength)}},this.handleTouchEnd=function(t){var l,h;t.touches&&t.touches.length||!t.changedTouches||(n.scaleLength=0,n.scaleArea?n.views.forEach((function(t){var n;null===(n=t.endScale)||void 0===n||n.call(t)})):null===(h=null===(l=n.scaleTarget)||void 0===l?void 0:l.endScale)||void 0===h||h.call(l),n.scaleTarget=void 0)},this.updateScale=function(t){var l,h;t&&1!==t&&(n.scaleArea?n.views.forEach((function(n){var l;null===(l=n.setScale)||void 0===l||l.call(n,t)})):null===(h=null===(l=n.scaleTarget)||void 0===l?void 0:l.setScale)||void 0===h||h.call(l,t))},this.updateArea=function(){var t=window.getComputedStyle(n.element),l=n.element.getBoundingClientRect(),h=["Left","Right"].map((function(n){return parseFloat(t["border"+n+"Width"])+parseFloat(t["padding"+n])})),u=["Top","Bottom"].map((function(n){return parseFloat(t["border"+n+"Width"])+parseFloat(t["padding"+n])}));n.views.forEach((function(t){var f;null===(f=t.setParent)||void 0===f||f.call(t,{"element":n.element,"area":{"height":l.height-u[0]-u[1],"width":l.width-h[0]-h[1]}})}))},this.scaleArea=void 0}return e.prototype.connectedCallback=function(){var t=this;this.observer=new MutationObserver((function(n){n.forEach((function(n){var l,h;if("class"===n.attributeName||"style"===n.attributeName){var u=t.element.offsetWidth,f=t.element.offsetHeight;u===(null===(l=t.offset)||void 0===l?void 0:l.width)&&f===(null===(h=t.offset)||void 0===h?void 0:h.height)||t.updateArea(),t.offset={"width":u,"height":f}}}))})),this.observer.observe(this.element,{"attributes":!0})},e.prototype.disconnectedCallback=function(){var t;null===(t=this.observer)||void 0===t||t.disconnect()},e.prototype.componentDidLoad=function(){this.viewsChanged()},e.prototype.render=function(){return(0,h.h)(h.H,{"onTouchStart":this.handleTouchStart,"onTouchMove":this.handleTouchMove,"onTouchEnd":this.handleTouchEnd})},Object.defineProperty(e.prototype,"element",{"get":function(){return(0,h.g)(this)},"enumerable":!1,"configurable":!0}),e}();u.style="taro-movable-area-core{display:block;position:relative;width:10px;height:10px}";var f=function(){function e(t){var n=this;(0,h.r)(this,t),this.onChange=(0,h.c)(this,"change",7),this.onScale=(0,h.c)(this,"scale",7),this.onHTouchMove=(0,h.c)(this,"htouchmove",7),this.onVTouchMove=(0,h.c)(this,"vtouchmove",7),this.translateX=0,this.translateY=0,this.origin={"x":0,"y":0},this.area={"width":0,"height":0},this.originScale=1,this.currentScale=1,this.width=0,this.height=0,this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.baseX=0,this.baseY=0,this.offset={"x":0,"y":0},this.scaleOffset={"x":0,"y":0},this.getLimitXY=function(t,l){var h=!1;return t>n.maxX?(t=n.maxX,h=!0):t<n.minX&&(t=n.minX,h=!0),l>n.maxY?(l=n.maxY,h=!0):l<n.minY&&(l=n.minY,h=!0),{"x":t,"y":l,"outOfBounds":h}},this.animationTo=function(t,l,h,u,f,d,v){n.animation?(n.setTransform(t,l,h,u,f,d),null==v||v()):n.setTransform(t,l,h,u,f,d)},this.setTransform=function(t,l,h,u,f,d){if(t=Number(t.toFixed(1)),l=Number(l.toFixed(1)),h=Number((null!=h?h:n.currentScale).toFixed(3)),!n.outOfBounds){var v=n.getLimitXY(t,l);t=v.x,l=v.y}var c=function(t,n){return+((1e3*t-1e3*n)/1e3).toFixed(1)},p=c(t,n.scaleOffset.x),m=c(l,n.scaleOffset.y);n.translateX===t&&n.translateY===l||!f&&n.onChange.emit({"x":p,"y":m,"source":u}),h!==n.currentScale&&d&&n.onScale.emit({"scale":h,"x":p,"y":m});var g="translateX(".concat(t,"px) translateY(").concat(l,"px) translateZ(0px) scale(").concat(h,")");n.element.style.transform=g,n.element.style.webkitTransform=g,n.translateX=t,n.translateY=l,n.currentScale=h},this.updateOffset=function(){var e=function(t,n){if(t===n||!t.offsetParent)return{"left":0,"top":0};var l=e(t.offsetParent,n);return{"left":t.offsetLeft+l.left,"top":t.offsetTop+l.top}};if(n.parent){var t=e(n.element,n.parent);n.offset.x=t.left,n.offset.y=t.top}},this.updateScaleOffset=function(t){void 0===t&&(t=n.currentScale);var l=n.element.getBoundingClientRect();n.height=l.height/n.currentScale,n.width=l.width/n.currentScale,n.scaleOffset.x=(n.width*t-n.width)/2,n.scaleOffset.y=(n.height*t-n.height)/2},this.updateBoundary=function(){var t=0-n.offset.x+n.scaleOffset.x,l=n.area.width-n.width-n.offset.x-n.scaleOffset.x;n.minX=Math.min(t,l),n.maxX=Math.max(t,l);var h=0-n.offset.y+n.scaleOffset.y,u=n.area.height-n.height-n.offset.y-n.scaleOffset.y;n.minY=Math.min(h,u),n.maxY=Math.max(h,u)},this.updateScale=function(t,l,h){if(n.scale){var u=n.adjustScale(t);n.updateScaleOffset(u),n.updateBoundary();var f=n.getLimitXY(n.translateX,n.translateY),d=f.x,v=f.y;l?n.animationTo(d,v,u,"",!0,!0,h):n.updating||(n.updating=!0,requestAnimationFrame((function(){n.setTransform(d,v,u,"",!0,!0),n.updating=!1})))}},this.setOriginScale=function(t){n.originScale=t},this.adjustScale=function(t){return Math.min(10,n.scaleMax,Math.max(.5,n.scaleMin,t))},this.handleTouchStart=function(t){var l=t.touches;if(!(n.disabled||l.length>1)&&n.element){var h=l[0];n.touching=!0,n.firstMoveFireEvent=!1,n.origin.x=h.screenX,n.origin.y=h.screenY,n.baseX=n.translateX,n.baseY=n.translateY,n.element.style.willChange="transform"}},this.handleTouchMove=function(t){var l=t.touches;if(!(n.disabled||!n.element||n.scaling||!n.touching||l.length>1)){t.preventDefault();var h=l[0],u=h.screenX-n.origin.x,f=h.screenY-n.origin.y;if(n.setTransform(n.xMove?u+n.baseX:0,n.yMove?f+n.baseY:0),!n.firstMoveFireEvent)n.firstMoveFireEvent=!0,(Math.abs(u)>Math.abs(f)?n.onHTouchMove:n.onVTouchMove).emit({"originalEvent":t,"bubbles":!1,"capturePhase":!1,"composed":!0,"extraFields":{"touches":t.touches||{},"changedTouches":t.changedTouches||{}}})}},this.handleTouchEnd=function(t){var l=t.changedTouches[0];if(!n.disabled&&n.touching&&l){n.touching=!1;var h=l.screenX-n.origin.x,u=l.screenY-n.origin.y;n.setTransform(n.xMove?h+n.baseX:0,n.yMove?u+n.baseY:0)}},this.x=0,this.y=0,this.direction="none",this.outOfBounds=!1,this.inertia=!1,this.friction=2,this.damping=20,this.disabled=!1,this.scale=!1,this.scaleMin=.5,this.scaleMax=10,this.scaleValue=1,this.animation=!0}return e.prototype.watchX=function(t){this.setTransform(parseFloat("".concat(t||0)),this.translateY)},e.prototype.watchY=function(t){this.setTransform(this.translateX,parseFloat("".concat(t||0)))},e.prototype.watchScaleMinOrMax=function(){if(!this.scale)return!1;this.updateScale(this.currentScale,!0),this.setOriginScale(this.currentScale)},e.prototype.watchScaleValue=function(t){return!!this.scale&&(this.updateScale(t,!0),this.setOriginScale(t),t)},e.prototype.setParent=function(t){var n=t.element,l=t.area;return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(h){return t=this.scale?this.scaleValue:1,this.area=l,this.parent=n,this.updateOffset(),this.updateScaleOffset(t),this.updateBoundary(),this.setTransform(Number(this.x)+this.scaleOffset.x,Number(this.y)+this.scaleOffset.y,t,"",!0),this.setOriginScale(t),[2]}))}))},e.prototype.endScale=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return this.scaling=!1,this.setOriginScale(this.currentScale),[2]}))}))},e.prototype.setScale=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(n){return this.scale?(this.scaling=!0,this.updateScale(t*this.originScale),[2]):[2]}))}))},e.prototype.connectedCallback=function(){var t=this;this.observer=new MutationObserver((function(n){n.forEach((function(n){var l=n.attributeName;if(l&&["class","style"].includes(l)){var h=n.oldValue,u=n.target.getAttribute(l);if(h===u)return;var r=function(t){return null==t?void 0:t.split(";").filter((function(t){return!["transform","will-change"].find((function(n){return t.trim().startsWith(n)}))})).join(";")};if("style"===l&&r(u)===r(h))return;t.updateOffset(),t.updateScaleOffset(),t.updateBoundary(),t.setTransform(t.translateX,t.translateY)}}))})),this.observer.observe(this.element,{"attributes":!0,"attributeOldValue":!0})},e.prototype.disconnectedCallback=function(){var t;null===(t=this.observer)||void 0===t||t.disconnect()},e.prototype.componentDidLoad=function(){if(this.element.style.transformOrigin="center",this.xMove=["horizontal","all"].includes(this.direction),this.yMove=["vertical","all"].includes(this.direction),this.friction<=0&&(this.friction=2),this.x||this.y){var t=parseFloat("".concat(this.x||0)),n=parseFloat("".concat(this.y||0));this.setTransform(t,n)}},e.prototype.render=function(){return(0,h.h)(h.H,{"onTouchStart":this.handleTouchStart,"onTouchMove":this.handleTouchMove,"onTouchEnd":this.handleTouchEnd})},Object.defineProperty(e.prototype,"element",{"get":function(){return(0,h.g)(this)},"enumerable":!1,"configurable":!0}),Object.defineProperty(e,"watchers",{"get":function(){return{"x":["watchX"],"y":["watchY"],"scaleMin":["watchScaleMinOrMax"],"scaleMax":["watchScaleMinOrMax"],"scaleValue":["watchScaleValue"]}},"enumerable":!1,"configurable":!0}),e}();f.style="taro-movable-view-core{display:inline-block;position:absolute;left:0;top:0;width:10px;height:10px}"}}]);